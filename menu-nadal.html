---
layout: default
title: Men√∫ de Nadal
---

<section class="section bg-gradient-to-br from-red-50 to-green-50 min-h-screen">
  <div class="container">
    <!-- Header navide√±o -->
    <div class="max-w-3xl mx-auto text-center mb-16">
      <div class="mb-8">
        <div class="flex justify-center items-center space-x-4 mb-4">
          <span class="text-4xl">‚ùÑÔ∏è</span>
          <span class="text-6xl">üéÑ</span>
          <span class="text-4xl">‚ùÑÔ∏è</span>
        </div>
        <div class="flex justify-center items-center space-x-2 mb-4">
          <span class="text-2xl">üåü</span>
          <span class="text-2xl">üïØÔ∏è</span>
          <span class="text-2xl">üéÅ</span>
        </div>
      </div>
      
      <h1 class="text-5xl md:text-6xl font-serif font-bold mb-6 text-red-800">
        Men√∫ de Nadal
      </h1>
      
      <div class="w-24 h-1 bg-gradient-to-r from-red-500 to-green-500 mx-auto mb-6"></div>
      
      <p class="text-xl text-gray-700 mb-8 leading-relaxed">
        {{ site.data.menu_nadal.description.ca }}
      </p>
      
    </div>
    
    <!-- Men√∫ en formato tradicional -->
    <div class="max-w-2xl mx-auto">
      <div class="bg-white rounded-2xl shadow-2xl p-8 border-4 border-red-200">
        
        <!-- APERITIU -->
        {% assign aperitiu = site.data.menu_nadal.menu.items | where: "menu_area", "APERITIU" %}
        {% if aperitiu.size > 0 %}
          <div class="mb-12">
            <h2 class="text-3xl font-serif font-bold mb-6 text-center text-red-800 border-b-2 border-red-200 pb-3">
              {{ site.data.menu_nadal.menu.areas.APERITIU.ca }}
            </h2>
            {% for category in aperitiu %}
              {% for item in category.items %}
                <div class="mb-6">
                  <h3 class="text-xl font-bold text-gray-800 mb-2">{{ item.name.ca }}</h3>
                  {% if item.description %}
                    <p class="text-gray-600 italic">{{ item.description.ca }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        {% endif %}

        <!-- Separador decorativo -->
        <div class="flex justify-center items-center my-8">
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-red-300 to-transparent"></div>
          <span class="mx-4 text-2xl">‚ùÑÔ∏è</span>
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-red-300 to-transparent"></div>
        </div>

        <!-- PRIMERS -->
        {% assign primers = site.data.menu_nadal.menu.items | where: "menu_area", "PRIMERS" %}
        {% if primers.size > 0 %}
          <div class="mb-12">
            <h2 class="text-3xl font-serif font-bold mb-6 text-center text-green-800 border-b-2 border-green-200 pb-3">
              {{ site.data.menu_nadal.menu.areas.PRIMERS.ca }}
            </h2>
            {% for category in primers %}
              {% for item in category.items %}
                <div class="mb-6">
                  <h3 class="text-xl font-bold text-gray-800 mb-2">{{ item.name.ca }}</h3>
                  {% if item.description %}
                    <p class="text-gray-600 italic">{{ item.description.ca }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        {% endif %}

        <!-- Separador decorativo -->
        <div class="flex justify-center items-center my-8">
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-green-300 to-transparent"></div>
          <span class="mx-4 text-2xl">üåü</span>
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-green-300 to-transparent"></div>
        </div>

        <!-- PLATS PRINCIPALS -->
        {% assign principals = site.data.menu_nadal.menu.items | where: "menu_area", "PRINCIPALS" %}
        {% if principals.size > 0 %}
          <div class="mb-12">
            <h2 class="text-3xl font-serif font-bold mb-6 text-center text-red-800 border-b-2 border-red-200 pb-3">
              {{ site.data.menu_nadal.menu.areas.PRINCIPALS.ca }}
            </h2>
            {% for category in principals %}
              {% for item in category.items %}
                <div class="mb-6">
                  <h3 class="text-xl font-bold text-gray-800 mb-2">{{ item.name.ca }}</h3>
                  {% if item.description %}
                    <p class="text-gray-600 italic">{{ item.description.ca }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        {% endif %}

        <!-- Separador decorativo -->
        <div class="flex justify-center items-center my-8">
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-red-300 to-transparent"></div>
          <span class="mx-4 text-2xl">üéÅ</span>
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-red-300 to-transparent"></div>
        </div>

        <!-- POSTRES -->
        {% assign postres = site.data.menu_nadal.menu.items | where: "menu_area", "POSTRES" %}
        {% if postres.size > 0 %}
          <div class="mb-12">
            <h2 class="text-3xl font-serif font-bold mb-6 text-center text-green-800 border-b-2 border-green-200 pb-3">
              {{ site.data.menu_nadal.menu.areas.POSTRES.ca }}
            </h2>
            {% for category in postres %}
              {% for item in category.items %}
                <div class="mb-6">
                  <h3 class="text-xl font-bold text-gray-800 mb-2">{{ item.name.ca }}</h3>
                  {% if item.description %}
                    <p class="text-gray-600 italic">{{ item.description.ca }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        {% endif %}

        <!-- Separador decorativo -->
        <div class="flex justify-center items-center my-8">
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-green-300 to-transparent"></div>
          <span class="mx-4 text-2xl">üïØÔ∏è</span>
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-green-300 to-transparent"></div>
        </div>

        <!-- VINS RECOMANATS -->
        {% assign secrets = site.data.menu_nadal.menu.items | where: "menu_area", "SECRETS" %}
        {% if secrets.size > 0 %}
          <div class="mb-8">
            <h2 class="text-3xl font-serif font-bold mb-6 text-center text-red-800 border-b-2 border-red-200 pb-3">
              Vins Recomanats
            </h2>
            {% for category in secrets %}
              {% for item in category.items %}
                <div class="mb-6">
                  <h3 class="text-xl font-bold text-gray-800 mb-2">{{ item.name.ca }}</h3>
                  {% if item.description %}
                    <p class="text-gray-600 italic">{{ item.description.ca }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        {% endif %}

      </div>
    </div>

    <!-- Secci√≥n de Reserva -->
    <div id="reserva-section" class="max-w-4xl mx-auto mt-16">
      <div class="text-center mb-8">
        <h3 class="text-2xl font-serif font-bold mb-4 text-gray-800">Reserva la teva taula per Nadal</h3>
        <p class="text-gray-600 mb-6">Celebra les festes amb nosaltres i gaudeix d'un men√∫ especial elaborat amb amor i tradici√≥.</p>
        <p class="text-sm text-gray-500 italic mb-4">El men√∫ de Nadal est√† disponible nom√©s els dies 25 i 26 de desembre</p>
      </div>
      
      <!-- Selector de fecha -->
      <div class="flex justify-center mb-6 space-x-4">
        <button 
          id="btn-25-dic" 
          class="date-selector active bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg text-base"
          onclick="showReservationDate('25')"
        >
          üìÖ Dimecres 25 de Desembre
        </button>
        <button 
          id="btn-26-dic" 
          class="date-selector bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg text-base"
          onclick="showReservationDate('26')"
        >
          üìÖ Dijous 26 de Desembre
        </button>
      </div>
      
      <!-- Iframe para d√≠a 25 -->
      <div id="reserva-25" class="reserva-iframe-container rounded-lg overflow-hidden shadow-lg relative bg-white">
        <script type="text/javascript" src="https://www.covermanager.com/js/iframeResizer/iframeResizer.min.js"></script>
        <iframe 
          id="restaurante-entrepreneur-25" 
          title="Reservas Men√∫ de Nadal - 25 de Desembre"
          src="https://www.covermanager.com/reservation/module_restaurant/restaurante-entrepreneur/catalan/25-12-2025"
          allow="payment" 
          frameborder="0" 
          height="550" 
          width="100%" 
          onload="if(typeof iFrameResize !== 'undefined') iFrameResize();">
        </iframe>
      </div>
      
      <!-- Iframe para d√≠a 26 -->
      <div id="reserva-26" class="reserva-iframe-container rounded-lg overflow-hidden shadow-lg relative bg-white hidden">
        <script type="text/javascript" src="https://www.covermanager.com/js/iframeResizer/iframeResizer.min.js"></script>
        <iframe 
          id="restaurante-entrepreneur-26" 
          title="Reservas Men√∫ de Nadal - 26 de Desembre"
          src="https://www.covermanager.com/reservation/module_restaurant/restaurante-entrepreneur/catalan/26-12-2025"
          allow="payment" 
          frameborder="0" 
          height="550" 
          width="100%" 
          onload="if(typeof iFrameResize !== 'undefined') iFrameResize();">
        </iframe>
      </div>
    </div>

    <!-- Secci√≥n de Pago -->
    <div class="max-w-2xl mx-auto mt-16">
      <div class="bg-white rounded-2xl shadow-2xl p-8 border-4 border-green-200">
        <h2 class="text-3xl font-serif font-bold mb-4 text-center text-green-800 border-b-2 border-green-200 pb-3">
          üí≥ Pagar i Confirmar Reserva
        </h2>
        
        <p class="text-sm text-gray-600 text-center mb-6 italic">
          ‚ö†Ô∏è Important: El nom i l'email han de ser els mateixos que els de la reserva.
        </p>
        
        <form id="payment-form" class="space-y-6">
          <!-- Nombre -->
          <div>
            <label for="customer-name" class="block text-sm font-medium text-gray-700 mb-2">
              Nom complet *
            </label>
            <input 
              type="text" 
              id="customer-name" 
              name="customer-name" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
              placeholder="El teu nom"
            >
          </div>

          <!-- Email -->
          <div>
            <label for="customer-email" class="block text-sm font-medium text-gray-700 mb-2">
              Email *
            </label>
            <input 
              type="email" 
              id="customer-email" 
              name="customer-email" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
              placeholder="el.teu.email@exemple.com"
            >
          </div>

          <!-- N√∫mero de personas -->
          <div>
            <label for="num-persons" class="block text-sm font-medium text-gray-700 mb-2">
              Nombre de persones *
            </label>
            <input 
              type="number" 
              id="num-persons" 
              name="num-persons" 
              min="1" 
              max="20" 
              required
              value="2"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
            >
          </div>

          <!-- Tipo de pago -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">
              Tipus de pagament *
            </label>
            <div class="space-y-3">
              <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-400 transition-colors payment-option">
                <input 
                  type="radio" 
                  name="payment-type" 
                  value="full" 
                  checked
                  class="mr-3 h-4 w-4 text-green-600 focus:ring-green-500"
                >
                <div class="flex-1">
                  <div class="font-semibold text-gray-800">Pagament complet</div>
                  <div class="text-sm text-gray-600">Paga tot el men√∫ ara</div>
                </div>
                <div class="text-lg font-bold text-green-700" id="full-price">‚Ç¨0.00</div>
              </label>
              
              <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-400 transition-colors payment-option">
                <input 
                  type="radio" 
                  name="payment-type" 
                  value="deposit"
                  class="mr-3 h-4 w-4 text-green-600 focus:ring-green-500"
                >
                <div class="flex-1">
                  <div class="font-semibold text-gray-800">Senyal</div>
                  <div class="text-sm text-gray-600">Fes una paga i senyal per confirmar la reserva</div>
                </div>
                <div class="text-lg font-bold text-green-700" id="deposit-price">‚Ç¨0.00</div>
              </label>
            </div>
          </div>

          <!-- Precio total -->
          <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200">
            <div class="flex justify-between items-center">
              <span class="text-lg font-semibold text-gray-800">Total a pagar:</span>
              <span class="text-2xl font-bold text-green-700" id="total-price">‚Ç¨0.00</span>
            </div>
          </div>

          <!-- Bot√≥n de pago -->
          <button 
            type="submit" 
            id="submit-payment"
            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg transition-colors text-lg disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="button-text">Procedir al Pagament</span>
            <span id="button-loading" class="hidden">Processant...</span>
          </button>

          <!-- Mensajes de estado -->
          <div id="payment-messages" class="hidden"></div>
        </form>
      </div>
    </div>
  </div>
</section>

<style>
  .bg-gradient-to-br {
    background: linear-gradient(135deg, #fef2f2 0%, #f0fdf4 100%);
  }
  
  .bg-gradient-to-r {
    background: linear-gradient(90deg, #fef2f2 0%, #f0fdf4 100%);
  }
  
  .shadow-md {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }
  
  .transition-colors {
    transition: background-color 0.3s ease;
  }

  .payment-option input:checked + div {
    border-color: #16a34a;
  }
  
  .payment-option input:checked {
    border-color: #16a34a;
  }
</style>

<script>
  // Funci√≥n para cambiar entre fechas de reserva
  function showReservationDate(date) {
    // Ocultar todos los iframes
    document.getElementById('reserva-25').classList.add('hidden');
    document.getElementById('reserva-26').classList.add('hidden');
    
    // Remover clase active de todos los botones
    document.getElementById('btn-25-dic').classList.remove('active', 'bg-red-600', 'text-white');
    document.getElementById('btn-25-dic').classList.add('bg-gray-300', 'text-gray-800');
    document.getElementById('btn-26-dic').classList.remove('active', 'bg-red-600', 'text-white');
    document.getElementById('btn-26-dic').classList.add('bg-gray-300', 'text-gray-800');
    
    // Mostrar el iframe seleccionado y activar el bot√≥n correspondiente
    if (date === '25') {
      document.getElementById('reserva-25').classList.remove('hidden');
      document.getElementById('btn-25-dic').classList.add('active', 'bg-red-600', 'text-white');
      document.getElementById('btn-25-dic').classList.remove('bg-gray-300', 'text-gray-800');
    } else if (date === '26') {
      document.getElementById('reserva-26').classList.remove('hidden');
      document.getElementById('btn-26-dic').classList.add('active', 'bg-red-600', 'text-white');
      document.getElementById('btn-26-dic').classList.remove('bg-gray-300', 'text-gray-800');
    }
    
    // Re-inicializar el resizer del iframe visible
    setTimeout(() => {
      if (typeof iFrameResize !== 'undefined') {
        const iframeId = date === '25' ? '#restaurante-entrepreneur-25' : '#restaurante-entrepreneur-26';
        iFrameResize({}, iframeId);
      }
    }, 100);
  }
  
  // Configuraci√≥n de precios (ajustar seg√∫n necesidad)
  const PRICE_PER_PERSON = 50; // Precio por persona en euros
  
  // Configuraci√≥n de la URL de la funci√≥n de Netlify
  // Detecta autom√°ticamente si est√° en localhost y usa la funci√≥n local de prueba
  function getNetlifyFunctionUrl() {
    const isLocalhost = window.location.hostname === 'localhost' || 
                        window.location.hostname === '127.0.0.1' ||
                        window.location.hostname === '';
    
    // Si estamos en un dominio de Netlify (producci√≥n o preview), usar URL relativa
    if (window.location.hostname.includes('netlify.app') || window.location.hostname.includes('netlify.com')) {
      return '/.netlify/functions/create-checkout-session';
    }
    
    // Si estamos en localhost, intentar usar el servidor local de prueba primero
    if (isLocalhost) {
      // Primero intentar el servidor local de prueba (puerto 3001)
      const localTestServer = 'http://localhost:3001/.netlify/functions/create-checkout-session';
      
      // Si no est√° configurada la URL de Netlify, usar el servidor local
      const netlifySiteUrl = '{{ site.netlify.site_url }}'.trim();
      
      if (!netlifySiteUrl || netlifySiteUrl === '') {
        console.log('üìç Usando servidor local de prueba en: http://localhost:3001');
        console.log('üí° Ejecuta "node test-stripe-local.js" en otra terminal');
        return localTestServer;
      }
      
      // Si est√° configurada, intentar primero el servidor local, luego Netlify
      // (el servidor local tiene prioridad para desarrollo)
      console.log('üìç Intentando servidor local primero, luego Netlify si falla');
      return localTestServer;
    }
    
    // Fallback: usar URL relativa
    return '/.netlify/functions/create-checkout-session';
  }
  
  // Elementos del DOM
  const form = document.getElementById('payment-form');
  const numPersonsInput = document.getElementById('num-persons');
  const paymentTypeInputs = document.querySelectorAll('input[name="payment-type"]');
  const fullPriceEl = document.getElementById('full-price');
  const depositPriceEl = document.getElementById('deposit-price');
  const totalPriceEl = document.getElementById('total-price');
  const submitButton = document.getElementById('submit-payment');
  const buttonText = document.getElementById('button-text');
  const buttonLoading = document.getElementById('button-loading');
  const messagesEl = document.getElementById('payment-messages');

  // Funci√≥n para calcular precios
  function calculatePrices() {
    const numPersons = parseInt(numPersonsInput.value) || 1;
    const fullPrice = numPersons * PRICE_PER_PERSON;
    const depositPrice = fullPrice * 0.5; // 50% de se√±al
    
    fullPriceEl.textContent = `‚Ç¨${fullPrice.toFixed(2)}`;
    depositPriceEl.textContent = `‚Ç¨${depositPrice.toFixed(2)}`;
    
    // Actualizar precio total seg√∫n tipo de pago seleccionado
    const selectedType = document.querySelector('input[name="payment-type"]:checked').value;
    const totalPrice = selectedType === 'deposit' ? depositPrice : fullPrice;
    totalPriceEl.textContent = `‚Ç¨${totalPrice.toFixed(2)}`;
  }

  // Event listeners para actualizar precios
  numPersonsInput.addEventListener('input', calculatePrices);
  paymentTypeInputs.forEach(input => {
    input.addEventListener('change', calculatePrices);
  });

  // Inicializar precios
  calculatePrices();

  // Manejar env√≠o del formulario
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Deshabilitar bot√≥n
    submitButton.disabled = true;
    buttonText.classList.add('hidden');
    buttonLoading.classList.remove('hidden');
    messagesEl.classList.add('hidden');
    messagesEl.innerHTML = '';

    // Obtener datos del formulario
    const name = document.getElementById('customer-name').value;
    const email = document.getElementById('customer-email').value;
    const numPersons = parseInt(numPersonsInput.value);
    const paymentType = document.querySelector('input[name="payment-type"]:checked').value;
    
    // Calcular monto
    const fullPrice = numPersons * PRICE_PER_PERSON;
    const amount = paymentType === 'deposit' ? fullPrice * 0.5 : fullPrice;

    try {
      // Obtener la URL de la funci√≥n (detecta autom√°ticamente el entorno)
      const functionUrl = getNetlifyFunctionUrl();
      
      // Llamar a la funci√≥n de Netlify
      const response = await fetch(functionUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          amount,
          type: paymentType,
          numPersons,
          email,
          name,
        }),
      });

      // Verificar el tipo de contenido de la respuesta
      const contentType = response.headers.get('content-type');
      if (!contentType || !contentType.includes('application/json')) {
        // Si no es JSON, probablemente es HTML (p√°gina de error)
        const textResponse = await response.text();
        console.error('Respuesta no JSON recibida:', textResponse.substring(0, 200));
        throw new Error('La funci√≥n de pago no est√° disponible. Aseg√∫rate de estar usando Netlify Dev o que la funci√≥n est√© desplegada.');
      }

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || data.message || 'Error al crear la sesi√≥n de pago');
      }

      // Redirigir a Stripe Checkout
      if (data.url) {
        window.location.href = data.url;
      } else {
        throw new Error('No se recibi√≥ la URL de checkout');
      }
    } catch (error) {
      console.error('Error completo:', error);
      messagesEl.classList.remove('hidden');
      
      let errorMessage = error.message;
      if (error.message.includes('Unexpected token')) {
        errorMessage = 'La funci√≥n de pago no est√° disponible. Si est√°s en desarrollo local, ejecuta "netlify dev". Si est√°s en producci√≥n, verifica que la funci√≥n est√© desplegada correctamente.';
      }
      
      messagesEl.innerHTML = `
        <div class="bg-red-50 border-2 border-red-200 text-red-800 px-4 py-3 rounded-lg">
          <p class="font-semibold">Error al procesar el pago</p>
          <p class="text-sm mt-1">${errorMessage}</p>
          <p class="text-sm mt-2">Si el problema persiste, contacta'ns directament.</p>
          <p class="text-xs mt-2 text-gray-600">Detalles t√©cnicos: ${error.message}</p>
        </div>
      `;
      
      // Rehabilitar bot√≥n
      submitButton.disabled = false;
      buttonText.classList.remove('hidden');
      buttonLoading.classList.add('hidden');
    }
  });

  // Manejar mensajes de √©xito/cancelaci√≥n desde la URL
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    
    if (urlParams.get('success') === 'true') {
      messagesEl.classList.remove('hidden');
      messagesEl.innerHTML = `
        <div class="bg-green-50 border-2 border-green-200 text-green-800 px-4 py-3 rounded-lg">
          <p class="font-semibold">‚úÖ Pagament realitzat amb √®xit!</p>
          <p class="text-sm mt-1">Rebr√†s un email de confirmaci√≥ amb els detalls de la teva reserva.</p>
          <p class="text-sm mt-2">Gr√†cies per confiar en nosaltres per celebrar el Nadal!</p>
        </div>
      `;
      // Scroll a los mensajes
      messagesEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      // Limpiar par√°metros de URL
      window.history.replaceState({}, document.title, window.location.pathname);
    } else if (urlParams.get('canceled') === 'true') {
      messagesEl.classList.remove('hidden');
      messagesEl.innerHTML = `
        <div class="bg-yellow-50 border-2 border-yellow-200 text-yellow-800 px-4 py-3 rounded-lg">
          <p class="font-semibold">‚ö†Ô∏è Pagament cancel¬∑lat</p>
          <p class="text-sm mt-1">El pagament ha estat cancel¬∑lat. Pots tornar a intentar-ho quan vulguis.</p>
        </div>
      `;
      // Scroll a los mensajes
      messagesEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      // Limpiar par√°metros de URL
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  });
</script>
